/**
 * File generated by the ThingML IDE
 * /!\Do not edit this file/!\
 * In case of a bug in the generated code,
 * please submit an issue on our GitHub
 **/

package org.thingml.generated;

import no.sintef.jasm.*;
import no.sintef.jasm.ext.*;

import org.thingml.generated.api.*;
import org.thingml.generated.messages.*;

import java.util.*;

/**
 * Definition for type : App
 **/
public class App extends Component implements IApp_app {

private boolean debug = false;
public boolean isDebug() {return debug;}
public void setDebug(boolean debug) {this.debug = debug;}
public String toString() {
String result = "instance " + getName() + "\n";
result += "\tid = " + App_id_var;
result += "\trnd = " + Msgs_rnd_var;
result += "";
return result;
}

public synchronized void m1_via_app(byte Msgs_m1_a_var, byte Msgs_m1_b_var, byte Msgs_m1_c_var, byte Msgs_m1_d_var, byte Msgs_m1_e_var){
final Event _msg = m1Type.instantiate(Msgs_m1_a_var, Msgs_m1_b_var, Msgs_m1_c_var, Msgs_m1_d_var, Msgs_m1_e_var);
_msg.setPort(app_port);
receive(_msg);
}

public synchronized void m2_via_app(byte Msgs_m2_a_var, byte Msgs_m2_b_var, byte Msgs_m2_c_var){
final Event _msg = m2Type.instantiate(Msgs_m2_a_var, Msgs_m2_b_var, Msgs_m2_c_var);
_msg.setPort(app_port);
receive(_msg);
}

private void sendM3_via_app(byte Msgs_m3_a_var){
app_port.send(m3Type.instantiate(Msgs_m3_a_var));
}

//Attributes
private final java.util.Random Msgs_rnd_var;
private byte App_id_var;
private java.util.Random debug_Msgs_rnd_var;
private byte debug_App_id_var;
//Ports
private Port app_port;
//Message types
protected final M1MessageType m1Type = new M1MessageType();
protected final M2MessageType m2Type = new M2MessageType();
protected final M3MessageType m3Type = new M3MessageType();
//Empty Constructor
public App() {
super();
Msgs_rnd_var = (java.util.Random) new java.util.Random();
}

//Constructor (only readonly (final) attributes)
public App(final java.util.Random Msgs_rnd_var) {
super();
this.Msgs_rnd_var = Msgs_rnd_var;
}

//Constructor (all attributes)
public App(String name, final java.util.Random Msgs_rnd_var, final byte App_id_var) {
super(name);
this.Msgs_rnd_var = Msgs_rnd_var;
this.App_id_var = App_id_var;
}

//Getters and Setters for non readonly/final attributes
public java.util.Random getMsgs_rnd_var() {
return Msgs_rnd_var;
}

public byte getApp_id_var() {
return App_id_var;
}

public void setApp_id_var(byte App_id_var) {
this.App_id_var = App_id_var;
}

//Getters for Ports
public Port getApp_port() {
return app_port;
}
private CompositeState buildApp(){
final AtomicState state_App_null_WaitForM1 = new AtomicState("WaitForM1");
final AtomicState state_App_null_WaitForM2 = new AtomicState("WaitForM2");
final AtomicState state_App_null_SendAck = new AtomicState("SendAck");
state_App_null_SendAck.onEntry(()->{
synchronized(System.out) {
System.out.print("#APP: Come get some app!m3(");
System.out.print(String.format("0x%02X",(getApp_id_var())));
System.out.print(")!");
System.out.println();
}
sendM3_via_app((byte) (getApp_id_var()));
});
Transition h282278242 = new Transition();
h282278242.from(state_App_null_WaitForM1).to(state_App_null_WaitForM2);
h282278242.event(m1Type);
h282278242.port(app_port);
h282278242.action((Event e)->{
final M1MessageType.M1Message m1 = (M1MessageType.M1Message) e;
App_id_var = (byte) (m1.a);
synchronized(System.out) {
System.out.print("#APP: Ooh, I needed that app?m1(");
System.out.print(String.format("0x%02X",(m1.a)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m1.b)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m1.c)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m1.d)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m1.e)));
System.out.print(")!");
System.out.println();
}
});

Transition h910458397 = new Transition();
h910458397.from(state_App_null_WaitForM2).to(state_App_null_SendAck);
h910458397.event(m2Type);
h910458397.port(app_port);
h910458397.action((Event e)->{
final M2MessageType.M2Message m2 = (M2MessageType.M2Message) e;
synchronized(System.out) {
System.out.print("#APP: Ooh, I needed that app?m2(");
System.out.print(String.format("0x%02X",(m2.a)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m2.b)));
System.out.print(", ");
System.out.print(String.format("0x%02X",(m2.c)));
System.out.print(")!");
System.out.println();
}
});

Transition h1931760728 = new Transition();
h1931760728.from(state_App_null_SendAck).to(state_App_null_WaitForM1);
final CompositeState state_App = new CompositeState("null");
state_App.add(state_App_null_WaitForM1);
state_App.add(state_App_null_WaitForM2);
state_App.add(state_App_null_SendAck);
state_App.initial(state_App_null_WaitForM1);
return state_App;
}

public Component buildBehavior(String session, Component root) {
if (root == null) {
//Init ports
app_port = new Port("app", this);
} else {
app_port = ((App)root).app_port;
}
if (session == null){
//Init state machine
behavior = buildApp();
}
return this;
}

private byte rnd() {
return (byte) ((byte) getMsgs_rnd_var().nextInt(256));
}
}
